<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQLè¯­å¥ç”Ÿæˆå·¥å…·ç®±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        accent: '#8B5CF6',
                        dark: '#1E293B',
                        light: '#F8FAFC',
                        neutral: '#64748B',
                        'neutral-light': '#F1F5F9',
                        'neutral-dark': '#334155',
                        success: '#10B981',
                        error: '#EF4444',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    boxShadow: {
                        'soft': '0 5px 15px rgba(0, 0, 0, 0.05)',
                        'medium': '0 8px 30px rgba(0, 0, 0, 0.12)',
                        'hard': '0 12px 40px rgba(0, 0, 0, 0.18)',
                        'inner-soft': 'inset 0 2px 4px 0 rgba(0, 0, 0, 0.06)',
                        'card': '0 10px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.02)',
                        'card-hover': '0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)',
                        'toast': '0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)',
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-up': 'slideUp 0.4s ease-out',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' }
                        }
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }
            .text-shadow-lg {
                text-shadow: 0 4px 8px rgba(0, 0, 0, 0.12);
            }
            .card-3d {
                transform: perspective(1000px) rotateX(0deg);
                transition: transform 0.3s ease, box-shadow 0.3s ease;
            }
            .card-3d:hover {
                transform: perspective(1000px) rotateX(2deg) translateY(-5px);
                box-shadow: var(--tw-shadow-card-hover);
            }
            .button-press {
                transition: all 0.1s ease;
            }
            .button-press:active {
                transform: translateY(2px);
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }
            .input-focus {
                transition: all 0.2s ease;
            }
            .input-focus:focus {
                transform: translateY(-1px);
                box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
            }
            .glass-effect {
                background: rgba(255, 255, 255, 0.7);
                backdrop-filter: blur(10px);
                -webkit-backdrop-filter: blur(10px);
            }
            .gradient-border {
                position: relative;
                border-radius: 0.75rem;
            }
            .gradient-border::before {
                content: "";
                position: absolute;
                inset: -2px;
                z-index: -1;
                border-radius: 0.85rem;
                background: linear-gradient(135deg, #3B82F6, #8B5CF6);
                opacity: 0;
                transition: opacity 0.3s ease;
            }
            .gradient-border:hover::before {
                opacity: 1;
            }
            .scrollbar-thin {
                scrollbar-width: thin;
            }
            .scrollbar-thin::-webkit-scrollbar {
                width: 6px;
                height: 6px;
            }
            .scrollbar-thin::-webkit-scrollbar-track {
                background: #f1f5f9;
                border-radius: 3px;
            }
            .scrollbar-thin::-webkit-scrollbar-thumb {
                background: #cbd5e1;
                border-radius: 3px;
            }
            .scrollbar-thin::-webkit-scrollbar-thumb:hover {
                background: #94a3b8;
            }
            .tab-active {
                border-bottom: 3px solid #3B82F6;
                color: #3B82F6;
                font-weight: 600;
            }
            .toast-success {
                background-color: rgba(16, 185, 129, 0.95);
            }
            .toast-error {
                background-color: rgba(239, 68, 68, 0.95);
            }
            .toast-content {
                text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            }
        }
    </style>
    <style>
        /* å…³é”®ä¿®å¤ï¼šç¦ç”¨æ–‡æœ¬åŒºåŸŸç¼©æ”¾ + ä¼˜åŒ–æ¸²æŸ“æ€§èƒ½ */
        #sqlResult {
            resize: none !important; /* å¼ºåˆ¶ç¦æ­¢æ‰‹åŠ¨ç¼©æ”¾ */
            will-change: auto;       /* å‘Šè¯‰æµè§ˆå™¨æå‰å‡†å¤‡æ¸²æŸ“å˜åŒ– */
            backface-visibility: hidden; /* é˜²æ­¢é—ªçƒ */
            -webkit-font-smoothing: antialiased; /* å­—ä½“æŠ—é”¯é½¿ */
            font-variant-ligatures: none; /* ç¦ç”¨è¿å­—ä¼˜åŒ–ï¼Œé¿å…æ¨¡ç³Š */
            transform: translateZ(0); /* è§¦å‘GPUåŠ é€Ÿ */
        }

        /* å¹³æ»‘æ»šåŠ¨ */
        html {
            scroll-behavior: smooth;
        }

        /* é˜²æ­¢æ¨¡æ€æ¡†æ‰“å¼€æ—¶é¡µé¢æŠ–åŠ¨ */
        body.modal-open {
            overflow: hidden;
            padding-right: 15px; /* åŒ¹é…æ»šåŠ¨æ¡å®½åº¦ */
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen font-sans text-dark">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- æ ‡é¢˜åŒºåŸŸ -->
        <header class="mb-8 text-center animate-fade-in">
            <h1 class="text-[clamp(2rem,5vw,3rem)] font-bold text-dark mb-2 text-shadow-lg">
                <i class="fa fa-database text-primary mr-3"></i>SQLè¯­å¥ç”Ÿæˆå·¥å…·ç®±
            </h1>
            <p class="text-gray-600 text-lg max-w-2xl mx-auto">
                æ”¯æŒæ‰¹é‡ç”ŸæˆSQLæ’å…¥/æ›´æ–°è¯­å¥ï¼Œé€šè¿‡Excelæ¨¡æ¿å¿«é€Ÿå¤„ç†æ•°æ®
            </p>

            <!-- åŠŸèƒ½åˆ‡æ¢æ ‡ç­¾ -->
            <div class="flex justify-center mt-6 border-b border-gray-200 max-w-3xl mx-auto">
                <button id="insertTab" class="tab-active px-6 py-3 text-lg focus:outline-none transition-all">
                    ä¸­èŒæ’å…¥è¯­å¥
                </button>
                <button id="updateTab" class="px-6 py-3 text-lg text-gray-500 focus:outline-none transition-all">
                    ä¸­èŒæ›´æ–°è¯­å¥
                </button>
                <button id="middleInsertTab" class="px-6 py-3 text-lg text-gray-500 focus:outline-none transition-all">
                    é«˜/åˆä¸­æ’å…¥è¯­å¥
                </button>
                <button id="middleUpdateTab" class="px-6 py-3 text-lg text-gray-500 focus:outline-none transition-all">
                    é«˜/åˆä¸­æ›´æ–°è¯­å¥
                </button>
            </div>
        </header>

        <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
        <main class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- å·¦ä¾§æ§åˆ¶é¢æ¿ -->
            <div class="lg:col-span-1 space-y-6 animate-slide-up" style="animation-delay: 0.1s">
                <!-- æ§åˆ¶é¢æ¿å¡ç‰‡ -->
                <div class="bg-white rounded-xl shadow-card p-6 card-3d">
                    <h2 class="text-xl font-bold mb-4 flex items-center text-neutral-dark">
                        <i class="fa fa-sliders text-primary mr-2"></i>æ§åˆ¶é¢æ¿
                    </h2>
                    
                    <!-- æ–‡ä»¶æ“ä½œæŒ‰é’® -->
                    <div class="space-y-4">
                        <button id="downloadTemplate" class="w-full bg-primary hover:bg-primary/90 text-white font-medium py-3 px-4 rounded-lg shadow-soft flex items-center justify-center button-press gradient-border">
                            <i class="fa fa-download mr-2"></i> ä¸‹è½½Excelæ¨¡æ¿
                        </button>
                        
                        <div class="relative">
                            <label for="excelFile" class="w-full bg-secondary hover:bg-secondary/90 text-white font-medium py-3 px-4 rounded-lg shadow-soft flex items-center justify-center cursor-pointer button-press gradient-border">
                                <i class="fa fa-upload mr-2"></i> å¯¼å…¥Excelæ–‡ä»¶
                                <input type="file" id="excelFile" accept=".xlsx" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" />
                            </label>
                        </div>
                        
                        <button id="generateSQL" class="w-full bg-accent hover:bg-accent/90 text-white font-medium py-3 px-4 rounded-lg shadow-soft flex items-center justify-center button-press gradient-border">
                            <i class="fa fa-code mr-2"></i> ç”ŸæˆSQLè¯­å¥
                        </button>
                        
                        <button id="clearResult" class="w-full bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-3 px-4 rounded-lg shadow-soft flex items-center justify-center button-press">
                            <i class="fa fa-trash mr-2"></i> æ¸…ç©ºç»“æœ
                        </button>
                        
                        <button id="saveSQL" class="w-full bg-gray-700 hover:bg-gray-800 text-white font-medium py-3 px-4 rounded-lg shadow-soft flex items-center justify-center button-press">
                            <i class="fa fa-save mr-2"></i> ä¿å­˜SQLè¯­å¥
                        </button>
                    </div>
                </div>
                
                <!-- çŠ¶æ€é¢æ¿ -->
                <div class="bg-white rounded-xl shadow-card p-6 card-3d">
                    <h2 class="text-xl font-bold mb-4 flex items-center text-neutral-dark">
                        <i class="fa fa-info-circle text-primary mr-2"></i>å½“å‰çŠ¶æ€
                    </h2>
                    <div id="status" class="bg-neutral-light rounded-lg p-4 min-h-[100px] border border-gray-200">
                        <p class="text-gray-600">è¯·ä¸‹è½½æ¨¡æ¿å¹¶å¡«å†™æ•°æ®</p>
                    </div>
                </div>
            </div>
            
            <!-- å³ä¾§ç»“æœæ˜¾ç¤ºåŒºåŸŸ -->
            <div class="lg:col-span-2 animate-slide-up" style="animation-delay: 0.2s">
                <div class="bg-white rounded-xl shadow-card p-6 h-full flex flex-col card-3d">
                    <h2 class="text-xl font-bold mb-4 flex items-center text-neutral-dark">
                        <i class="fa fa-code text-primary mr-2"></i>ç”Ÿæˆçš„SQLè¯­å¥
                    </h2>
                    
                    <!-- SQLç»“æœæ–‡æœ¬åŒºåŸŸ -->
                    <div class="flex-grow mb-4">
                        <div class="relative h-full">
                            <textarea id="sqlResult" class="w-full h-full p-4 bg-neutral-light rounded-lg border border-gray-200 focus:border-primary focus:ring-2 focus:ring-primary/20 input-focus resize-none font-mono text-sm" placeholder="ç”Ÿæˆçš„SQLè¯­å¥å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..."></textarea>
                            <div class="absolute bottom-3 right-3 text-xs text-gray-400">
                                <span id="lineCount">0</span> è¡Œ
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- æ•°æ®é¢„è§ˆåŒºåŸŸ -->
        <div class="mt-8 bg-white rounded-xl shadow-card p-6 card-3d animate-slide-up" style="animation-delay: 0.3s">
            <h2 class="text-xl font-bold mb-4 flex items-center text-neutral-dark">
                <i class="fa fa-table text-primary mr-2"></i>æ•°æ®é¢„è§ˆ
                <span id="dataCount" class="ml-2 text-sm font-normal text-neutral">0 æ¡è®°å½•</span>
            </h2>
            <div id="dataPreview" class="overflow-x-auto max-h-[300px] scrollbar-thin">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="sticky top-0 z-10 bg-neutral-light">
                        <tr id="previewHeader">
                            <!-- è¡¨å¤´å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                        </tr>
                    </thead>
                    <tbody id="previewBody" class="bg-white divide-y divide-gray-200">
                        <!-- æ•°æ®è¡Œå°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- é¡µè„š -->
        <footer class="mt-12 text-center text-gray-500 text-sm animate-fade-in" style="animation-delay: 0.4s">
            <p>SQLè¯­å¥ç”Ÿæˆå·¥å…·ç®± &copy; 2025 | è®¾è®¡ä¸å¼€å‘</p>
        </footer>
    </div>

    <!-- æç¤ºæ¡† -->
    <div id="toast" class="fixed bottom-6 right-6 px-6 py-4 rounded-lg shadow-toast transform translate-y-20 opacity-0 transition-all duration-300 flex items-center z-50 font-medium text-white toast-content">
        <i id="toastIcon" class="fa fa-check-circle mr-3 text-xl"></i>
        <span id="toastMessage"></span>
    </div>

    <!-- åŠ è½½ä¸­æ¨¡æ€æ¡† -->
    <div id="loadingModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl p-6 shadow-hard flex flex-col items-center glass-effect">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary mb-4"></div>
            <p id="loadingMessage" class="text-gray-700 font-medium">å¤„ç†ä¸­...</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script>
        // å…¨å±€å˜é‡
        let excelData = null;
        let sqlResult = '';
        let currentMode = 'insert'; // é»˜è®¤ï¼šæ’å…¥æ¨¡å¼ï¼ˆinsert/updateï¼‰
        let currentTableType = 'zzxs'; // é»˜è®¤ä¸­èŒè¡¨ï¼ˆzzxs-ä¸­èŒå­¦ç”Ÿï¼Œzxxs-ä¸­å°å­¦å­¦ç”Ÿï¼‰
        
        // æ–°å¢ï¼šå°†getModeTextå‡½æ•°ç§»åˆ°å…¨å±€ä½œç”¨åŸŸ
        function getModeText() {
            // æ ¹æ®å½“å‰æ¨¡å¼è¿”å›ä¸­æ–‡æè¿°
            const modeMap = {
                'insert': 'ä¸­èŒæ’å…¥',
                'update': 'ä¸­èŒæ›´æ–°',
                'middleInsert': 'é«˜/åˆä¸­æ’å…¥',
                'middleUpdate': 'é«˜/åˆä¸­æ›´æ–°'
            };
            return modeMap[currentMode] || 'æœªçŸ¥æ¨¡å¼';
        }
        
        // DOMå…ƒç´ 
        const insertTab = document.getElementById('insertTab');
        const updateTab = document.getElementById('updateTab');
        const downloadTemplateBtn = document.getElementById('downloadTemplate');
        const excelFileInput = document.getElementById('excelFile');
        const generateSQLBtn = document.getElementById('generateSQL');
        const clearResultBtn = document.getElementById('clearResult');
        const saveSQLBtn = document.getElementById('saveSQL');
        const statusEl = document.getElementById('status');
        const sqlResultEl = document.getElementById('sqlResult');
        const lineCountEl = document.getElementById('lineCount');
        const dataPreviewHeader = document.getElementById('previewHeader');
        const dataPreviewBody = document.getElementById('previewBody');
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toastMessage');
        const toastIcon = document.getElementById('toastIcon');
        const loadingModal = document.getElementById('loadingModal');
        const loadingMessage = document.getElementById('loadingMessage');
        const dataCountEl = document.getElementById('dataCount');
        const middleInsertTab = document.getElementById('middleInsertTab');
        const middleUpdateTab = document.getElementById('middleUpdateTab');
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            updateStatus('è¯·ä¸‹è½½æ¨¡æ¿å¹¶å¡«å†™æ•°æ®');
            updateLineCount();
            
            // æ ‡ç­¾åˆ‡æ¢äº‹ä»¶
            insertTab.addEventListener('click', () => switchMode('insert'));
            updateTab.addEventListener('click', () => switchMode('update'));
            
            // äº‹ä»¶ç›‘å¬
            downloadTemplateBtn.addEventListener('click', downloadTemplate);
            excelFileInput.addEventListener('change', handleFileUpload);
            generateSQLBtn.addEventListener('click', generateSQL);
            clearResultBtn.addEventListener('click', clearResult);
            saveSQLBtn.addEventListener('click', saveSQL);
            middleInsertTab.addEventListener('click', () => switchMode('middleInsert'));
            middleUpdateTab.addEventListener('click', () => switchMode('middleUpdate'));  
            
            // è‡ªåŠ¨è°ƒæ•´æ–‡æœ¬åŒºåŸŸé«˜åº¦
            sqlResultEl.addEventListener('input', adjustTextareaHeight);
            
            // ç¡®ä¿æç¤ºæ¡†åœ¨æœ€ä¸Šå±‚
            document.body.appendChild(toast);
        });
        
        // åˆ‡æ¢æ¨¡å¼ï¼ˆæ’å…¥/æ›´æ–°ï¼‰
        function switchMode(mode) {
            // é‡ç½®æ‰€æœ‰æ ‡ç­¾æ ·å¼
            [insertTab, updateTab, middleInsertTab, middleUpdateTab].forEach(tab => {
                tab.classList.remove('tab-active');
                tab.classList.add('text-gray-500');
            });

            // æ›´æ–°å½“å‰æ¨¡å¼å’Œæ ‡ç­¾æ ·å¼
            currentMode = mode;
            let modeText = '';
            let tableType = ''; // ç”¨äºåŒºåˆ†ä¸­èŒ/é«˜åˆä¸­çš„æ•°æ®åº“è¡¨
    
            switch(mode) {
                case 'insert':
                    insertTab.classList.add('tab-active');
                    insertTab.classList.remove('text-gray-500');
                    modeText = 'ä¸­èŒæ’å…¥';
                    tableType = 'zzxs'; // ä¸­èŒè¡¨æ ‡è¯†
                    break;
                case 'update':
                    updateTab.classList.add('tab-active');
                    updateTab.classList.remove('text-gray-500');
                    modeText = 'ä¸­èŒæ›´æ–°';
                    tableType = 'zzxs';
                    break;
                case 'middleInsert':
                    middleInsertTab.classList.add('tab-active');
                    middleInsertTab.classList.remove('text-gray-500');
                    modeText = 'é«˜/åˆä¸­æ’å…¥';
                    tableType = 'zxxs'; // é«˜åˆä¸­è¡¨æ ‡è¯†
                    break;
                case 'middleUpdate':
                    middleUpdateTab.classList.add('tab-active');
                    middleUpdateTab.classList.remove('text-gray-500');
                    modeText = 'é«˜/åˆä¸­æ›´æ–°';
                    tableType = 'zxxs';
                    break;
            }

            // å­˜å‚¨å½“å‰æ¨¡å¼å¯¹åº”çš„è¡¨ç±»å‹ï¼ˆç”¨äºåç»­ç”ŸæˆSQLï¼‰
            currentTableType = tableType;
            
            // é‡ç½®çŠ¶æ€å¹¶æç¤º
            resetToolState();
            updateStatus(`å·²åˆ‡æ¢è‡³ã€${modeText}ã€‘æ¨¡å¼ï¼Œè¯·ä¸‹è½½å¯¹åº”æ¨¡æ¿`);
            showToast(`å·²åˆ‡æ¢è‡³ã€${modeText}ã€‘æ¨¡å¼`);
        }
        
        // é‡ç½®å·¥å…·çŠ¶æ€
        function resetToolState() {
            excelData = null;
            sqlResult = '';
            sqlResultEl.value = '';
            dataPreviewHeader.innerHTML = '';
            dataPreviewBody.innerHTML = '';
            dataCountEl.textContent = '0 æ¡è®°å½•';
            updateLineCount();
            excelFileInput.value = ''; // æ¸…ç©ºæ–‡ä»¶é€‰æ‹©
        }
        
        // æ›´æ–°çŠ¶æ€ä¿¡æ¯
        function updateStatus(message) {
            statusEl.innerHTML = `<p class="text-gray-600">${message}</p>`;
        }
        
        // æ˜¾ç¤ºæç¤ºæ¡†
        function showToast(message, isSuccess = true) {
            // ç¡®ä¿æç¤ºæ¡†åœ¨æœ€ä¸Šå±‚
            document.body.appendChild(toast);
            
            // è®¾ç½®æç¤ºæ¡†å†…å®¹
            toastMessage.textContent = message;
            
            // è®¾ç½®å›¾æ ‡å’ŒèƒŒæ™¯é¢œè‰²
            if (isSuccess) {
                toastIcon.className = 'fa fa-check-circle mr-3 text-xl';
                toast.classList.remove('toast-error');
                toast.classList.add('toast-success');
            } else {
                toastIcon.className = 'fa fa-exclamation-circle mr-3 text-xl';
                toast.classList.remove('toast-success');
                toast.classList.add('toast-error');
            }
            
            // æ˜¾ç¤ºæç¤ºæ¡†
            toast.classList.remove('translate-y-20', 'opacity-0');
            toast.classList.add('translate-y-0', 'opacity-1');
            
            // é˜²æ­¢å¤šæ¬¡ç‚¹å‡»å¯¼è‡´æç¤ºæ¡†ä¸æ¶ˆå¤±
            clearTimeout(toast.timeoutId);
            toast.timeoutId = setTimeout(() => {
                // éšè—æç¤ºæ¡†
                toast.classList.remove('translate-y-0', 'opacity-1');
                toast.classList.add('translate-y-20', 'opacity-0');
            }, 3000);
        }
        
        // æ˜¾ç¤ºåŠ è½½ä¸­
        function showLoading(message = 'å¤„ç†ä¸­...') {
            loadingMessage.textContent = message;
            loadingModal.classList.remove('hidden');
            document.body.classList.add('modal-open'); // é˜²æ­¢é¡µé¢æ»šåŠ¨
        }
        
        // éšè—åŠ è½½ä¸­
        function hideLoading() {
            loadingModal.classList.add('hidden');
            document.body.classList.remove('modal-open');
        }
        
        // æ›´æ–°è¡Œæ•°ç»Ÿè®¡
        function updateLineCount() {
            const lines = sqlResultEl.value.split('\n').length;
            lineCountEl.textContent = lines;
        }
        
        // è‡ªåŠ¨è°ƒæ•´æ–‡æœ¬åŒºåŸŸé«˜åº¦ï¼ˆä¼˜åŒ–ç‰ˆï¼‰
        function adjustTextareaHeight() {
            // é™åˆ¶æœ€å¤§é«˜åº¦ï¼Œè¶…è¿‡åˆ™æ˜¾ç¤ºæ»šåŠ¨æ¡
            const maxHeight = 600;
            const currentHeight = this.scrollHeight;
            
            if (currentHeight > maxHeight) {
                this.style.height = `${maxHeight}px`;
            } else {
                this.style.height = `${currentHeight}px`;
            }
        }
        
        // ä¸‹è½½æ¨¡æ¿ï¼ˆæ ¹æ®å½“å‰æ¨¡å¼åˆ‡æ¢æ¨¡æ¿ï¼‰
        function downloadTemplate() {
            showLoading(`æ­£åœ¨ç”Ÿæˆ${getModeText()}æ¨¡æ¿...`);
    
            setTimeout(() => {
                try {
                    let templateData, fileName, sheetName = "å­¦ç”Ÿä¿¡æ¯";
            
                    // æ ¹æ®å½“å‰æ¨¡å¼ç”Ÿæˆå¯¹åº”æ¨¡æ¿
                    if (currentMode === 'insert' || currentMode === 'update') {
                        // ä¸­èŒæ¨¡æ¿ï¼ˆä¿æŒåŸæœ‰é€»è¾‘ä¸å˜ï¼‰
                        if (currentMode === 'insert') {
                            templateData = [
                                {
                                    'å§“å': 'å¼ ä¸‰',
                                    'æ€§åˆ«': 'å¥³',
                                    'å‡ºç”Ÿæ—¥æœŸ': '20001030',
                                    'ä¸“ä¸šåç§°': 'é“é“è¿è¾“ç®¡ç†',
                                    'ä¸“ä¸šä»£ç ': '500112',
                                    'å­¦åˆ¶': 'ä¸‰å¹´åˆ¶',
                                    'å­¦æ ¡åç§°': 'ç§‘å°”æ²å·¦ç¿¼åæ——æ°‘æ—èŒä¸šæŠ€æœ¯å­¦æ ¡',
                                    'æ ¡é•¿å§“å': 'NULL',
                                    'è¯ä¹¦å·': '1505202303252495',
                                    'å­¦æ ¡æ‰€åœ¨ç›Ÿå¸‚': 'é€šè¾½å¸‚',
                                    'å­¦æ ¡æ‰€åœ¨ç›Ÿå¸‚ä»£ç ': '150500000000',
                                    'å…¥å­¦å¹´æœˆ': '201909',
                                    'æ¯•ä¸šå¹´æœˆ': '202307',
                                    'å­¦æ ¡æ ‡è¯†ç ': '3615000002',
                                    'ç­çº§åç§°': '19é“é“è¿è¾“ç®¡ç†1ç­',
                                    'hash_cedo': 'NULL',
                                    'èº«ä»½è¯ä»¶å·': '152323200010301221'
                                }
                            ];
                            fileName = "ä¸­èŒæ’å…¥æ¨¡æ¿.xlsx";
                        } else {
                            templateData = [
                                {
                                    'xm': 'å¼ ä¸‰',
                                    'xb': 'å¥³',
                                    'csrq': '20090912',
                                    'zymc': 'ç»˜ç”»',
                                    'zybm': '750107',
                                    'xz': 'ä¸‰å¹´åˆ¶',
                                    'xxmc': 'é€šè¾½ç»æµæŠ€æœ¯å¼€å‘åŒºæ¬§äºšåº”ç”¨ç§‘æŠ€ä¸­ç­‰èŒä¸šå­¦æ ¡',
                                    'xzxm': 'NULL',
                                    'zsh': '1505202501386551',
                                    'xxszsmc': 'é€šè¾½å¸‚',
                                    'xxszsdm': '150500000000',
                                    'rxny': '202209',
                                    'byny': '202507',
                                    'xxbsm': '3615000343',
                                    'bjmc': '2022çº§ç§‹å­£ä¸€ç­',
                                    'sfzjh': '152322200609121829',
                                    'original_sfzjh': '152322200609121829'
                                }
                            ];
                            fileName = "ä¸­èŒæ›´æ–°æ¨¡æ¿.xlsx";
                        }
                    } else if (currentMode === 'middleInsert' || currentMode === 'middleUpdate') {
                        // é«˜/åˆä¸­æ¨¡æ¿ï¼ˆæ ¹æ®ä½ æä¾›çš„å­—æ®µè°ƒæ•´ï¼‰
                        if (currentMode === 'middleInsert') {
                            templateData = [
                                {
                                    'å­¦ç”Ÿå§“å': 'å¼ ä¸‰',
                                    'æ€§åˆ«ç ': '1',
                                    'æ€§åˆ«': 'ç”·',
                                    'èº«ä»½è¯ä»¶å·': '150826200608155411',
                                    'æ°‘æ—ç ': '1',
                                    'æ°‘æ—': 'æ±‰æ—',
                                    'å‡ºç”Ÿæ—¥æœŸ': '20060815',
                                    'æˆ·å£æ‰€åœ¨åœ°ç ': 'NULL',
                                    'æˆ·å£æ‰€åœ¨åœ°': 'å†…è’™å¤è‡ªæ²»åŒºå·´å½¦æ·–å°”å¸‚ä¹Œæ‹‰ç‰¹å‰æ——',
                                    'å…¥å­¦å¹´æœˆ': '202209',
                                    'æ¯•ä¸šå¹´æœˆ': '202506',
                                    'å­¦æ ¡åç§°': 'å·´å½¦æ·–å°”å¸‚è¡¡è¶Šå®éªŒä¸­å­¦',
                                    'ç­çº§åç§°': 'é«˜ä¸­2022çº§9ç­',
                                    'åˆ¶è¯æ—¥æœŸ': 'NULL',
                                    'æ¯•ä¸šè¯ä¹¦å·': 'NULL',
                                    'å­¦æ®µçŠ¶æ€ç ': '3',
                                    'é¢„ç•™å­—æ®µ2': 'NULL',
                                    'é¢„ç•™å­—æ®µ3': 'NULL',
                                    'é¢„ç•™å­—æ®µ4': 'NULL',
                                    'é¢„ç•™å­—æ®µ5': 'NULL',
                                    'hash_code': 'NULL'
                                }
                            ];
                            fileName = "é«˜åˆä¸­æ’å…¥æ¨¡æ¿.xlsx";
                        } else {
                            templateData = [
                                {
                                    'xm': 'å¼ ä¸‰',
                                    'xbm': '01',
                                    'xb': 'ç”·',
                                    'sfzjh': '123456789012345678',
                                    'mzm': '01',
                                    'mz': 'æ±‰',
                                    'csrq': '20010315',
                                    'hkszdm': '710000000000',
                                    'hkszd': 'å°æ¹¾çœ',
                                    'rxny': '201209',
                                    'byny': '202406',
                                    'xxmc': 'å‘¼å’Œæµ©ç‰¹ç¬¬äºŒä¸­å­¦',
                                    'bjmc': 'é«˜ä¸­2021çº§',
                                    'ylzd1': '3',
                                    'original_sfzjh': '123456789012345678'
                                }
                            ];
                            fileName = "é«˜åˆä¸­æ›´æ–°æ¨¡æ¿.xlsx";
                        }
                    }
            
                    // åˆ›å»ºå·¥ä½œç°¿
                    const ws = XLSX.utils.json_to_sheet(templateData);
                    const wb = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(wb, ws, sheetName);
            
                    // ä¸‹è½½
                    XLSX.writeFile(wb, fileName);
            
                    updateStatus(`æ¨¡æ¿å·²ä¸‹è½½ï¼Œè¯·å¡«å†™æ•°æ®åå¯¼å…¥`);
                    showToast(`ğŸ‰ ${getModeText()}æ¨¡æ¿ä¸‹è½½æˆåŠŸï¼è¯·æŒ‰ç¤ºä¾‹å¡«å†™æ•°æ®`);
                } catch (error) {
                    updateStatus('æ¨¡æ¿ä¸‹è½½å¤±è´¥');
                    showToast('æ¨¡æ¿ä¸‹è½½å¤±è´¥ï¼Œè¯·é‡è¯•', false);
                    console.error('ä¸‹è½½æ¨¡æ¿å‡ºé”™:', error);
                }
        
                hideLoading();
            }, 800);
        }
        
        // å¤„ç†æ–‡ä»¶ä¸Šä¼ 
        function handleFileUpload(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            showLoading('æ­£åœ¨è§£ææ–‡ä»¶...');
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // è·å–ç¬¬ä¸€ä¸ªå·¥ä½œè¡¨
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    
                    // è½¬æ¢ä¸ºJSON
                    excelData = XLSX.utils.sheet_to_json(worksheet);
                    
                    if (excelData.length === 0) {
                        throw new Error('Excelæ–‡ä»¶ä¸­æ²¡æœ‰æ•°æ®');
                    }
                    
                    updateStatus(`å·²å¯¼å…¥ ${excelData.length} æ¡æ•°æ®`);
                    dataCountEl.textContent = `${excelData.length} æ¡è®°å½•`;
                    showToast(`ğŸ‰ æˆåŠŸå¯¼å…¥ ${excelData.length} æ¡æ•°æ®ï¼å¯ä»¥ç”ŸæˆSQLäº†`);
                    
                    // é¢„è§ˆæ•°æ®
                    previewData(excelData);
                } catch (error) {
                    updateStatus('æ–‡ä»¶è§£æå¤±è´¥');
                    showToast('æ–‡ä»¶è§£æå¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼', false);
                    console.error('è§£æExcelå‡ºé”™:', error);
                }
                
                hideLoading();
            };
            
            reader.readAsArrayBuffer(file);
        }
        
        // é¢„è§ˆæ•°æ®
        function previewData(data) {
            if (!data || data.length === 0) {
                dataPreviewHeader.innerHTML = '<th colspan="100%" class="text-center py-4 text-gray-500">æ— æ•°æ®</th>';
                dataPreviewBody.innerHTML = '';
                return;
            }
            
            // ç”Ÿæˆè¡¨å¤´
            const headers = Object.keys(data[0]);
            let headerHtml = '';
            headers.forEach(header => {
                headerHtml += `<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">${header}</th>`;
            });
            dataPreviewHeader.innerHTML = headerHtml;
            
            // ç”Ÿæˆæ•°æ®è¡Œ
            let bodyHtml = '';
            data.forEach((row, index) => {
                let rowHtml = `<tr class="${index % 2 === 0 ? 'bg-white' : 'bg-gray-50'}">`;
                headers.forEach(header => {
                    rowHtml += `<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${row[header] || '-'}</td>`;
                });
                rowHtml += '</tr>';
                bodyHtml += rowHtml;
            });
            
            dataPreviewBody.innerHTML = bodyHtml;
        }
        
        // ç”ŸæˆSQLï¼ˆæ ¹æ®å½“å‰æ¨¡å¼åˆ‡æ¢é€»è¾‘ï¼‰
        function generateSQL() {
            if (!excelData || excelData.length === 0) {
                showToast('è¯·å…ˆå¯¼å…¥Excelæ–‡ä»¶', false);
                return;
            }
    
            showLoading(`æ­£åœ¨ç”Ÿæˆ${getModeText()}SQLè¯­å¥...`);
    
            setTimeout(() => {
                try {
                    let sql = '';
                    let tableName = currentTableType === 'zzxs' ? "kdsj_zzxs_zhizheng" : "kdsj_zxxs_xueji";
                    let generatedCount = 0;
                    let skippedCount = 0;
            
                    // æ ¹æ®æ¨¡å¼ç”Ÿæˆå¯¹åº”SQL
                    if (currentMode === 'insert' || currentMode === 'middleInsert') {
                        // æ’å…¥è¯­å¥é€»è¾‘
                        excelData.forEach((row, index) => {
                            // è·³è¿‡ç©ºè¡Œ
                            const isEmptyRow = Object.values(row).every(value => 
                                value === undefined || 
                                value === null || 
                                (typeof value === 'string' && value.trim() === '')
                            );
                    
                            if (isEmptyRow) {
                                skippedCount++;
                                return;
                            }
                    
                            // æ£€æŸ¥å¿…å¡«å­—æ®µ
                            const requiredFields = currentTableType === 'zzxs' 
                                ? ['å§“å', 'èº«ä»½è¯ä»¶å·', 'è¯ä¹¦å·'] 
                                : ['å­¦ç”Ÿå§“å', 'èº«ä»½è¯ä»¶å·', 'å…¥å­¦å¹´æœˆ', 'å­¦æ ¡åç§°'];
                    
                            const hasRequiredFields = requiredFields.some(field => 
                                row[field] !== undefined && 
                                row[field] !== null && 
                                (typeof row[field] !== 'string' || row[field].trim() !== '')
                            );
                    
                            if (!hasRequiredFields) {
                                skippedCount++;
                                return;
                            }
                    
                            // æ„å»ºæ’å…¥è¯­å¥
                            if (currentTableType === 'zzxs') {
                                // ä¸­èŒæ’å…¥è¯­å¥
                                sql += `INSERT INTO \`${tableName}\` VALUES (`;
                                sql += `'${escapeSqlValue(row.å§“å || '')}', `;
                                sql += `'${escapeSqlValue(row.æ€§åˆ« || '')}', `;
                                sql += `'${escapeSqlValue(row.å‡ºç”Ÿæ—¥æœŸ || '')}', `;
                                sql += `'${escapeSqlValue(row.ä¸“ä¸šåç§° || '')}', `;
                                sql += `'${escapeSqlValue(row.ä¸“ä¸šä»£ç  || '')}', `;
                                sql += `'${escapeSqlValue(row.å­¦åˆ¶ || '')}', `;
                                sql += `'${escapeSqlValue(row.å­¦æ ¡åç§° || '')}', `;
                                sql += `${isNullOrEmpty(row.æ ¡é•¿å§“å) ? 'NULL' : `'${escapeSqlValue(row.æ ¡é•¿å§“å || '')}'`}, `;
                                sql += `'${escapeSqlValue(row.è¯ä¹¦å· || '')}', `;
                                sql += `'${escapeSqlValue(row.å­¦æ ¡æ‰€åœ¨ç›Ÿå¸‚ || '')}', `;
                                sql += `'${escapeSqlValue(row.å­¦æ ¡æ‰€åœ¨ç›Ÿå¸‚ä»£ç  || '')}', `;
                                sql += `'${escapeSqlValue(row.å…¥å­¦å¹´æœˆ || '')}', `;
                                sql += `'${escapeSqlValue(row.æ¯•ä¸šå¹´æœˆ || '')}', `;
                                sql += `'${escapeSqlValue(row.å­¦æ ¡æ ‡è¯†ç  || '')}', `;
                                sql += `'${escapeSqlValue(row.ç­çº§åç§° || '')}', `;
                                sql += `${isNullOrEmpty(row.hash_cedo) ? 'NULL' : `'${escapeSqlValue(row.hash_cedo || '')}'`}, `;
                                sql += `${isNullOrEmpty(row.èº«ä»½è¯ä»¶å·) ? 'NULL' : `'${escapeSqlValue(row.èº«ä»½è¯ä»¶å· || '')}'`}`;
                                sql += `);\n`;
                            } else {
                                // é«˜/åˆä¸­æ’å…¥è¯­å¥
                                sql += `INSERT INTO \`${tableName}\` VALUES (`;
                                sql += `'${escapeSqlValue(row.å­¦ç”Ÿå§“å || '')}', `;
                                sql += `'${escapeSqlValue(row.æ€§åˆ«ç  || '')}', `;
                                sql += `'${escapeSqlValue(row.æ€§åˆ« || '')}', `;
                                sql += `'${escapeSqlValue(row.èº«ä»½è¯ä»¶å· || '')}', `;
                                sql += `'${escapeSqlValue(row.æ°‘æ—ç  || '')}', `;
                                sql += `'${escapeSqlValue(row.æ°‘æ— || '')}', `;
                                sql += `'${escapeSqlValue(row.å‡ºç”Ÿæ—¥æœŸ || '')}', `;
                                sql += `${isNullOrEmpty(row.æˆ·å£æ‰€åœ¨åœ°ç ) ? 'NULL' : `'${escapeSqlValue(row.æˆ·å£æ‰€åœ¨åœ°ç )}'`}, `;
                                sql += `'${escapeSqlValue(row.æˆ·å£æ‰€åœ¨åœ° || '')}', `;
                                sql += `'${escapeSqlValue(row.å…¥å­¦å¹´æœˆ || '')}', `;
                                sql += `'${escapeSqlValue(row.æ¯•ä¸šå¹´æœˆ || '')}', `;
                                sql += `'${escapeSqlValue(row.å­¦æ ¡åç§° || '')}', `;
                                sql += `'${escapeSqlValue(row.ç­çº§åç§° || '')}', `;
                                sql += `${isNullOrEmpty(row.åˆ¶è¯æ—¥æœŸ) ? 'NULL' : `'${escapeSqlValue(row.åˆ¶è¯æ—¥æœŸ)}'`}, `;
                                sql += `${isNullOrEmpty(row.æ¯•ä¸šè¯ä¹¦å·) ? 'NULL' : `'${escapeSqlValue(row.æ¯•ä¸šè¯ä¹¦å·)}'`}, `;
                                sql += `'${escapeSqlValue(row.å­¦æ®µçŠ¶æ€ç  || '')}', `;
                                sql += `${isNullOrEmpty(row.é¢„ç•™å­—æ®µ2) ? 'NULL' : `'${escapeSqlValue(row.é¢„ç•™å­—æ®µ2)}'`}, `;
                                sql += `${isNullOrEmpty(row.é¢„ç•™å­—æ®µ3) ? 'NULL' : `'${escapeSqlValue(row.é¢„ç•™å­—æ®µ3)}'`}, `;
                                sql += `${isNullOrEmpty(row.é¢„ç•™å­—æ®µ4) ? 'NULL' : `'${escapeSqlValue(row.é¢„ç•™å­—æ®µ4)}'`}, `;
                                sql += `${isNullOrEmpty(row.é¢„ç•™å­—æ®µ5) ? 'NULL' : `'${escapeSqlValue(row.é¢„ç•™å­—æ®µ5)}'`}, `;
                                sql += `${isNullOrEmpty(row.hash_code) ? 'NULL' : `'${escapeSqlValue(row.hash_code)}'`}`;
                                sql += `);\n`;
                            }
                    
                            generatedCount++;
                        });
                    } else {
                        // æ›´æ–°è¯­å¥é€»è¾‘
                        excelData.forEach((row, index) => {
                            // è·³è¿‡ç©ºè¡Œ
                            const isEmptyRow = Object.values(row).every(value => 
                                value === undefined || 
                                value === null || 
                                (typeof value === 'string' && value.trim() === '')
                            );
                    
                            if (isEmptyRow) {
                                skippedCount++;
                                return;
                            }
                    
                            // æ£€æŸ¥å¿…å¡«å­—æ®µ
                            const requiredFields = currentTableType === 'zzxs' 
                                ? ['sfzjh', 'original_sfzjh'] 
                                : ['sfzjh', 'original_sfzjh'];
                    
                            const hasRequiredFields = requiredFields.some(field => 
                                row[field] !== undefined && 
                                row[field] !== null && 
                                (typeof row[field] !== 'string' || row[field].trim() !== '')
                            );
                    
                            if (!hasRequiredFields) {
                                skippedCount++;
                                return;
                            }
                    
                            // æ„å»ºæ›´æ–°è¯­å¥
                            if (currentTableType === 'zzxs') {
                                // ä¸­èŒæ›´æ–°è¯­å¥
                                const setClauses = [];
                                const columns = ['xm', 'xb', 'csrq', 'zymc', 'zybm', 'xz', 'xxmc', 'xzxm', 'zsh', 'xxszsmc', 'xxszsdm', 'rxny', 'byny', 'xxbsm', 'bjmc', 'sfzjh'];
                        
                                columns.forEach(col => {
                                    if (row[col] !== undefined && row[col] !== null) {
                                        let value = row[col];
                                
                                        if (isNullOrEmpty(value)) {
                                            setClauses.push(`${col}=NULL`);
                                            return;
                                        }
                                
                                        value = escapeSqlValue(value.toString().trim());
                                        setClauses.push(`${col}='${value}'`);
                                    }
                                });
                        
                                const whereClause = `sfzjh='${escapeSqlValue(row.original_sfzjh || row.sfzjh)}'`;
                        
                                if (setClauses.length > 0) {
                                    sql += `UPDATE ${tableName} SET ${setClauses.join(', ')} WHERE ${whereClause};\n`;
                                    generatedCount++;
                                } else {
                                    skippedCount++;
                                }
                            } else {
                                // é«˜/åˆä¸­æ›´æ–°è¯­å¥
                                const setClauses = [];
                                const columns = ['xm', 'xbm', 'xb', 'sfzjh', 'mzm', 'mz', 'csrq', 'hkszdm', 'hkszd', 'rxny', 'byny', 'xxmc', 'bjmc', 'ylzd1'];
                        
                                columns.forEach(col => {
                                    if (row[col] !== undefined && row[col] !== null) {
                                        let value = row[col];
                                
                                        if (isNullOrEmpty(value)) {
                                            setClauses.push(`${col}=NULL`);
                                            return;
                                        }
                                
                                        value = escapeSqlValue(value.toString().trim());
                                        setClauses.push(`${col}='${value}'`);
                                    }
                                });
                        
                                const whereClause = `sfzjh='${escapeSqlValue(row.original_sfzjh || row.sfzjh)}'`;
                        
                                if (setClauses.length > 0) {
                                    sql += `UPDATE ${tableName} SET ${setClauses.join(', ')} WHERE ${whereClause};\n`;
                                    generatedCount++;
                                } else {
                                    skippedCount++;
                                }
                            }
                        });
                    }
            
                    // æ›´æ–°ç»“æœ
                    sqlResult = sql;
                    
                    // ä¼˜åŒ–æ–‡æœ¬åŒºåŸŸæ›´æ–°ï¼ˆå‡å°‘é—ªçƒï¼‰
                    sqlResultEl.style.transition = 'height 0.2s ease-out';
                    sqlResultEl.value = '';
                    setTimeout(() => {
                        sqlResultEl.value = sqlResult;
                        adjustTextareaHeight.call(sqlResultEl);
                        updateLineCount();
                        sqlResultEl.style.transition = 'none';
                    }, 50);
            
                    // æ›´æ–°çŠ¶æ€
                    const total = excelData.length;
                    if (generatedCount > 0) {
                        updateStatus(`å·²ç”Ÿæˆ ${generatedCount} æ¡SQLè¯­å¥ï¼Œè·³è¿‡ ${skippedCount} æ¡è®°å½•`);
                        showToast(`ğŸ‰ æˆåŠŸç”Ÿæˆ ${generatedCount} æ¡SQLè¯­å¥ï¼`);
                    } else {
                        updateStatus('æœªèƒ½ç”ŸæˆSQLè¯­å¥ï¼Œè¯·æ£€æŸ¥æ•°æ®æ ¼å¼');
                        showToast('æœªèƒ½ç”ŸæˆSQLè¯­å¥ï¼Œè¯·æ£€æŸ¥æ•°æ®æ ¼å¼', false);
                    }
                } catch (error) {
                    updateStatus('SQLç”Ÿæˆå¤±è´¥');
                    showToast('SQLç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•', false);
                    console.error('ç”ŸæˆSQLå‡ºé”™:', error);
                }
        
                hideLoading();
            }, 1000);
        }
        
        // æ¸…ç©ºç»“æœ
        function clearResult() {
            sqlResult = '';
            sqlResultEl.value = '';
            updateLineCount();
            showToast('å·²æ¸…ç©ºç»“æœ');
        }
        
        // ä¿å­˜SQL
        function saveSQL() {
            if (!sqlResult || sqlResult.trim() === '') {
                showToast('æ²¡æœ‰å¯ä¿å­˜çš„SQLè¯­å¥', false);
                return;
            }
            
            try {
                const blob = new Blob([sqlResult], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${getModeText()}SQL_${new Date().toISOString().slice(0, 10)}.sql`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showToast('SQLæ–‡ä»¶å·²ä¿å­˜');
            } catch (error) {
                showToast('ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•', false);
                console.error('ä¿å­˜SQLå‡ºé”™:', error);
            }
        }
        
        // è¾…åŠ©å‡½æ•°ï¼šè½¬ä¹‰SQLå€¼
        function escapeSqlValue(value) {
            if (value === undefined || value === null) {
                return '';
            }
            
            // å¤„ç†æ—¥æœŸæ ¼å¼
            if (typeof value === 'number' && /^\d{8}$/.test(value.toString())) {
                const dateStr = value.toString();
                return `${dateStr.substring(0, 4)}-${dateStr.substring(4, 6)}-${dateStr.substring(6, 8)}`;
            }
            
            // å¤„ç†å­—ç¬¦ä¸²è½¬ä¹‰
            if (typeof value === 'string') {
                return value
                    .replace(/'/g, "''") // å•å¼•å·è½¬ä¹‰
                    .replace(/\\/g, "\\\\"); // åæ–œæ è½¬ä¹‰
            }
            
            return value.toString();
        }
        
        // è¾…åŠ©å‡½æ•°ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºç©ºå€¼
        function isNullOrEmpty(value) {
            return value === undefined || value === null || value === '' || value === 'NULL';
        }
    </script>
</body>
</html>